{
  "build": {
    "dockerfile": "./Dockerfile",
    "context": "."
  },
  "capAdd": ["SYS_PTRACE"],
  "securityOpt": ["seccomp=unconfined"],
  "hostRequirements": {
    "gpu": true
  },
  "initializeCommand": "mkdir -p ../.cache ../.conda ../legion ../legate",
  "updateContentCommand": ["/opt/legate/bin/make-legate-test-env"],
  "postStartCommand": ["/bin/bash", "-li", "/opt/legate/bin/clone-legion"],
  "postAttachCommand": ["/bin/bash", "-li", "/opt/legate/bin/open-vscode-workspace"],
  // "postStartCommand": "cd /opt/legate/bin; ./clone-legion; ./open-vscode-workspace;",
  "workspaceFolder": "/workspaces",
  "mounts": [
    {
      "type": "bind",
      "target": "/workspaces/.cache",
      "source": "${localWorkspaceFolder}/../.cache"
    },
    {
      "type": "bind",
      "target": "/workspaces/.conda",
      "source": "${localWorkspaceFolder}/../.conda"
    },
    {
      "type": "bind",
      "target": "/workspaces/legion",
      "source": "${localWorkspaceFolder}/../legion"
    },
    {
      "type": "bind",
      "target": "/workspaces/legate",
      "source": "${localWorkspaceFolder}/../legate"
    }
  ],
  "containerEnv": {
    "CONDA_DEFAULT_ENV": "legate"
  },
  "customizations": {
    "vscode": {
      "extensions": [
        "twxs.cmake",
        "xaver.clang-format",
        "cschlosser.doxdocgen",
        "ms-vscode.cpptools",
        "nvidia.nsight-vscode-edition",
        "llvm-vs-code-extensions.vscode-clangd"
      ],
      "settings": {
        "C_Cpp.vcpkg.enabled": false,
        "C_Cpp.formatting": "disabled",
        "C_Cpp.autocomplete": "disabled",
        "C_Cpp.errorSquiggles": "disabled",
        "C_Cpp.intelliSenseEngine": "disabled",
        "C_Cpp.configurationWarnings": "disabled",
        "C_Cpp.autoAddFileAssociations": false,
        "clangd.arguments": [
          "--log=info",
          "--debug-origin",
          "--pch-storage=disk",
          "--completion-parse=auto",
          "--fallback-style=Google",
          "--background-index=true",
          "--all-scopes-completion",
          "--header-insertion=iwyu",
          "--completion-style=detailed",
          "--header-insertion-decorators"
        ],
        "files.trimFinalNewlines": true,
        "files.insertFinalNewline": true,
        "files.trimTrailingWhitespace": true,
        "files.associations": {
          "*.cu": "cuda-cpp",
          "*.cuh": "cuda-cpp",
          "**/libcudacxx/include/**/*": "cpp",
          "**/libcudacxx-src/include/**/*": "cpp"
        },
        "python.linting.enabled": true,
        "python.linting.pylintEnabled": true,
        "python.defaultInterpreterPath": "/workspaces/.conda/envs/legate-test/bin/python",
        "python.formatting.autopep8Path": "/workspaces/.conda/envs/legate-test/bin/autopep8",
        "python.formatting.blackPath": "/workspaces/.conda/envs/legate-test/bin/black",
        "python.formatting.yapfPath": "/workspaces/.conda/envs/legate-test/bin/yapf",
        "python.linting.banditPath": "/workspaces/.conda/envs/legate-test/bin/bandit",
        "python.linting.flake8Path": "/workspaces/.conda/envs/legate-test/bin/flake8",
        "python.linting.mypyPath": "/workspaces/.conda/envs/legate-test/bin/mypy",
        "python.linting.pycodestylePath": "/workspaces/.conda/envs/legate-test/bin/pycodestyle",
        "python.linting.pydocstylePath": "/workspaces/.conda/envs/legate-test/bin/pydocstyle",
        "python.linting.pylintPath": "/workspaces/.conda/envs/legate-test/bin/pylint",
        "python.terminal.activateEnvironment": false,
        "python.testing.promptToConfigure": false,
        "python.testing.autoTestDiscoverOnSaveEnabled": false,
        "[c]": {
          "editor.tabSize": 2,
          "editor.formatOnSave": false,
          "editor.formatOnSaveMode": "file",
          "editor.defaultFormatter": "xaver.clang-format"
        },
        "[cpp]": {
          "editor.tabSize": 2,
          "editor.formatOnSave": false,
          "editor.formatOnSaveMode": "file",
          "editor.defaultFormatter": "xaver.clang-format"
        },
        "[cuda-cpp]": {
          "editor.tabSize": 2,
          "editor.formatOnSave": false,
          "editor.formatOnSaveMode": "file",
          "editor.defaultFormatter": "xaver.clang-format"
        }
      }
    }
  }
}
